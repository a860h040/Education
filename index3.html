<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tutorial Player</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial,sans-serif;margin:24px;max-width:980px}
    h1{margin:0 0 12px}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px}
    button{padding:10px 14px;border-radius:12px;border:1px solid #ddd;background:#fff;cursor:pointer;font-weight:800}
    button:hover{background:#f6f6f6}
    button.active{border-color:#000;box-shadow:0 1px 0 rgba(0,0,0,.10)}
    .card{border:1px solid #e6e6e6;border-radius:16px;padding:14px}
    video{width:100%;height:auto;border-radius:14px;background:#000}
    .small{color:#666;font-size:13px;margin-top:10px;line-height:1.35}
  </style>
</head>
<body>

  <h1>Tutorial Player</h1>

  <div class="row">
    <button id="btnT1">Tutorial 1</button>
    <button id="btnT2">Tutorial 2</button>
    <button id="btnT3">Tutorial 3</button>
  </div>

  <div class="card">
    <div id="status" class="small">Choose a tutorial to play.</div>

    <!-- Add crossorigin for CORS safety; 'controls' lets user play if autoplay is blocked -->
    <video id="player" controls playsinline preload="auto" crossorigin="anonymous"></video>

    <!-- Hidden buffer video used only for preloading the next part -->
    <video id="buffer" preload="auto" playsinline muted crossorigin="anonymous" style="display:none;"></video>
  </div>

  <script>
    // NOTE: convert your .mov files to .mp4 (H.264/AAC) and update filenames here.
    // Example ffmpeg command:
    // ffmpeg -i input.mov -c:v libx264 -crf 22 -preset fast -c:a aac -b:a 128k output.mp4

    const BASE = "https://raw.githubusercontent.com/a860h040/Education/main/";

    // UPDATE to .mp4 filenames after conversion (or host on GitHub Pages / another server)
    const PLAYLISTS = {
      t1: [
        { title: "Part 1", url: BASE + "1.mp4" },
        { title: "Part 2", url: BASE + "2.mp4" }
      ],
      t2: [
        { title: "Part 3", url: BASE + "3.mp4" },
        { title: "Part 4", url: BASE + "4.mp4" },
        { title: "Part 5", url: BASE + "5.mp4" },
        { title: "Part 6", url: BASE + "6.mp4" }
      ],
      t3: [
        { title: "Part 7", url: BASE + "7.mp4" },
        { title: "Part 8", url: BASE + "8.mp4" }
      ]
    };

    // QUICK TEST: if you want to verify the player itself works before changing files,
    // uncomment the short playlist below (public sample MP4) and comment out the PLAYLISTS above.
    /*
    const PLAYLISTS = {
      t1: [{ title: "Test", url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4" }],
      t2: [{ title: "Test", url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4" }],
      t3: [{ title: "Test", url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4" }]
    };
    */

    const btnT1  = document.getElementById("btnT1");
    const btnT2  = document.getElementById("btnT2");
    const btnT3  = document.getElementById("btnT3");
    const player = document.getElementById("player");
    const buffer = document.getElementById("buffer");
    const status = document.getElementById("status");

    let currentParts = [];
    let idx = 0;

    function setActive(which){
      btnT1.classList.toggle("active", which === "t1");
      btnT2.classList.toggle("active", which === "t2");
      btnT3.classList.toggle("active", which === "t3");
    }

    function setVideoSource(videoEl, url, type = "video/mp4") {
      // Remove any existing <source> children, then add a fresh one
      while (videoEl.firstChild) videoEl.removeChild(videoEl.firstChild);
      const s = document.createElement("source");
      s.src = url;
      s.type = type;
      videoEl.appendChild(s);
      videoEl.load();
    }

    function preloadNext(i){
      const next = i + 1;
      if (next < currentParts.length) {
        buffer.src = currentParts[next].url;
        buffer.load();
        console.log("Preloading next:", currentParts[next].url);
      } else {
        // clear buffer
        buffer.removeAttribute("src");
        buffer.load();
      }
    }

    async function playPart(i){
      idx = i;
      const part = currentParts[idx];
      status.textContent = `Loading ${part.title}...`;
      console.log("PlayPart:", part);

      // Preload next part ASAP
      preloadNext(idx);

      // Cleanly set the source using a <source> element
      setVideoSource(player, part.url);

      // Diagnostic checks
      if (!player.canPlayType("video/mp4") && part.url.endsWith(".mp4")) {
        console.warn("Browser reports it may not support mp4. canPlayType:", player.canPlayType("video/mp4"));
      }

      try {
        // Attempt to autoplay — may be blocked by browser policies
        await player.play();
        status.textContent = `Playing ${part.title}`;
      } catch (err) {
        console.warn("Autoplay blocked or failed:", err);
        status.textContent = `Loaded ${part.title}. Press Play if it didn’t start automatically.`;
      }
    }

    function startTutorial(key){
      if (!PLAYLISTS[key] || PLAYLISTS[key].length === 0) {
        status.textContent = "Playlist is empty or missing.";
        return;
      }
      currentParts = PLAYLISTS[key].slice();
      setActive(key);
      playPart(0);
    }

    // Auto-advance immediately
    player.addEventListener("ended", () => {
      const next = idx + 1;
      if (next < currentParts.length) {
        playPart(next);
      } else {
        status.textContent = "Finished.";
      }
    });

    btnT1.addEventListener("click", () => startTutorial("t1"));
    btnT2.addEventListener("click", () => startTutorial("t2"));
    btnT3.addEventListener("click", () => startTutorial("t3"));

    // Helpful logging for debugging network / playback problems
    player.addEventListener("error", (e) => {
      console.error("Player error event:", e, player.error);
      status.textContent = "Playback error — see console (Ctrl+Shift+I) for details.";
    });
    player.addEventListener("stalled", () => console.warn("Player stalled (network)"));
    player.addEventListener("suspend", () => console.warn("Player suspended"));
  </script>

</body>
</html>
